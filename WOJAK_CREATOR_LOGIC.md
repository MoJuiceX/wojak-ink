# Wojak Creator Logic – Where Everything Lives

This file is a **quick reference** for all the moving parts that make the Wojak Creator work, so you (or future you) can always find and tweak the right pieces.

## 1. Core Components & Hooks

- **Window shell & layout**
  - `src/components/windows/WojakCreator.jsx`
  - Handles:
    - Desktop vs mobile layout (bottom sheet on mobile, side‑by‑side on desktop)
    - Centering the window on desktop
    - Wiring up canvas, trait selectors, export controls, and keyboard navigation
    - Randomize button (`handleRandomize`) using the UI layer order + manifest

- **Generator state + rendering**
  - `src/hooks/useMemeGenerator.js`
  - Handles:
    - `selectedLayers` and `layerVisibility` state
    - The **canonical render order** via `LAYER_ORDER` (from `memeLayers.js`)
    - Special handling for:
      - **Chia Farmer** overlay (`ClothesAddon` virtual layer)
      - **Astronaut** virtual layer (extracted from `Clothes`)
      - **Hannibal Mask** and **Tyson Tattoo** virtual layers
    - Debounced `selectLayer` and `renderCanvas` for smooth UX
    - Canvas drawing:
      - 800×800 canvas
      - Aspect‑ratio aware draw to fit images into the canvas
    - Preloading likely‑next assets (Eyes after Base, Head after Eyes, etc.)

- **Canvas wrapper**
  - `src/components/meme/MemeCanvas.jsx`
  - Just sets up the `<canvas>` element and ensures it fills the available space responsively.

## 2. Layer Order & Virtual Layers

- **Canonical render order**
  - `src/lib/memeLayers.js` → `LAYER_ORDER`
  - Encodes the **face render hierarchy** (background → base → clothes → facial hair → mouths → masks → eyes → virtuals → head).
  - Includes **virtual layers**:
    - `ClothesAddon` (Chia Farmer overlay)
    - `Astronaut`
    - `HannibalMask`
    - `TysonTattoo`
  - **UI layer list**:
    - `UI_LAYER_ORDER` excludes internal/virtual layers so the trait dropdowns only show user‑facing layers.

- **Key rules baked into order (top → bottom in comments)**
  - Head always over Eyes/Mask.
  - Mask over MouthBase/MouthItem.
  - Eyes over Mask.
  - Astronaut over Eyes, FacialHair, all mouth traits.
  - Tyson Tattoo only under Hannibal Mask, never exists without it.

## 3. Image Manifest & Trait Options

- **Manifest source**
  - `src/lib/memeImageManifest.js`
  - `HARDCODED_MANIFEST` lists all PNGs per logical layer and subfolder.
  - Regenerated by `npm run generate-meme-manifest` (run automatically during build).

- **Tray of available traits**
  - `getAllLayerImages(layerName)`:
    - Returns a **flat list** of images (path + display names) for a given layer.
    - Used by:
      - `LayerSelector` to populate dropdowns.
      - `WojakCreator`’s `handleRandomize()` to pick random traits.
  - `getLayerImagesBySubfolder(layerName)`:
    - Used by `useImageLoader` when you need images grouped by subfolder.

## 4. Rules Engine (What’s Allowed / Auto‑Fix)

- **Rule definitions**
  - `src/utils/wojakRules.js`
  - Contains the **Wojak Creator Rules System**:
    - Each rule receives `selectedLayers` and returns:
      - `disabledLayers` (layers to gray out)
      - `clearSelections` (layers to auto‑clear)
      - `forceSelections` (layers to auto‑set)
      - `disabledOptions` (specific options to disable in dropdowns)
      - `reason` (string explaining why)

- **Important rules**
  - `ruleBaseNeverNone` → Base auto‑defaults to **Classic** when any trait is picked.
  - Astronaut rules:
    - `ruleAstronautNoHead`
    - `ruleAstronautDisablesMouthItem`
    - `ruleAstronautMaskMutualExclusion`
  - Chia Farmer / Clothes overlay:
    - `ruleClothesAddonRequiresTeeOrTanktop` (forces Tee blue, manages addon state)
  - Mouth + Facial Hair + Mask interactions:
    - `ruleFacialHairRequiresMouthBase`
    - `ruleMaskBlocksOtherLayers`
    - `ruleCopiumMaskForcesValidMouthBase`
    - `ruleMaskForcesNumbMouth`
    - `rulePipeForcesNoMouthBase`
    - `ruleCigJointCohibaRequiresMouthBase`
    - `rulePizzaDisablesMouthItem`
    - `ruleBubbleGumDisablesMouthItem`
    - `ruleTysonTattooRequiresHannibalMask`

- **Rules engine entrypoint**
  - `getDisabledLayers(selectedLayers)`:
    - Runs all rules in order and merges their outputs.
    - Used by `useMemeGenerator` to:
      - Compute `disabledLayers` (for UI)
      - Auto‑clear / auto‑set layers when necessary.

## 5. Where to Start If You Need to Change Behavior

- **Change draw order / layering:**
  - Edit `LAYER_ORDER` (and `UI_LAYER_ORDER`) in `src/lib/memeLayers.js`.

- **Add or change a trait rule (what’s allowed together):**
  - Add a new rule function in `src/utils/wojakRules.js`.
  - Push it into the `RULES` array (order matters).

- **Add a new visual trait (PNG files):**
  - Drop PNGs into `public/wojak-creator/...` under the correct folder.
  - Regenerate manifest:
    - `npm run generate-meme-manifest`
  - Confirm they show up via `getAllLayerImages` and in the UI.

- **Change randomization behavior:**
  - Update `handleRandomize` in `src/components/windows/WojakCreator.jsx`:
    - It currently:
      - Iterates `UI_LAYER_ORDER`
      - Grabs all images for each layer via `getAllLayerImages`
      - Filters out `"None"` options
      - Picks a random valid image and calls `selectLayer`.

Keep this file around as your **source of truth** for “how the Wojak Creator actually works under the hood.” When in doubt, start here, then jump into the listed files. 






